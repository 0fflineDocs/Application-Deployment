
#Exempel på Remote Computer
#Invoke-command -computer RemoteComputerName {Get-Item......}
#PSSESSION-GETCRED = https://blogs.technet.microsoft.com/heyscriptingguy/2012/03/16/use-powershell-to-edit-the-registry-on-remote-computers/

$GG = Get-ItemPropertyValue -Path “HKLM:\SOFTWARE\Microsoft\SMS\COMPONENTS\SMS_EXECUTIVE\THREADS\SMS_CLOUD_USERSYNC\” -Name “Requested Operation” 
   
IF ($GG -match "None")
{
#Ändrar värdet på CLOUD_USERSYNC/Requested Operation till Stop
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\SMS\COMPONENTS\SMS_EXECUTIVE\THREADS\SMS_CLOUD_USERSYNC\" -Name "Requested Operation" -Value Stop
Write-Host CLOUD_USERSYNC stoppas, var god dröj!
start-sleep -Milliseconds 5000
}

IF ($GG -match "Stop")
{
#Ändrar värdet på CLOUD_USERSYNC/Requested Operation till Start
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\SMS\COMPONENTS\SMS_EXECUTIVE\THREADS\SMS_CLOUD_USERSYNC\" -Name "Requested Operation" -Value Start
Write-Host CLOUD_USERSYNC startar! Prova att registrera enheten på nytt om 5min!
start-sleep -Milliseconds 5000
}

IF  ($GG -match "Start")
{
#Meddelande
Write-Host Tjänsten återställs, lugna ner dig!
start-sleep -Milliseconds 10000
}
